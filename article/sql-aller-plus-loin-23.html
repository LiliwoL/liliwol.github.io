<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="ie=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"/>

<!--Meta Keywords and Description-->
<meta name="keywords" content="Formateur php symfony BTS Angular VueJS">
<meta name="description" content="">

<!--Favicon-->
<link rel="shortcut icon" href="/_assets/img/favicon.ico" title="Favicon"/>

<link rel="stylesheet" href="/_assets/main.css" />

<!-- Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <title>SQL Aller plus loin 2/3 - Supports de cours Nicolas C.</title>
  <link rel="stylesheet" href="/_markdown_plugin_assets/highlight.js/atom-one-light.css" /></head>

  <body>

    <div class="main">

      <nav class="navigation">
        <a href="/">Supports de cours Nicolas C.</a>
      </nav>

      <article>
        <header>
          <h1 class="article-title">SQL Aller plus loin 2/3</h1>
          <div class="article-info">
            <div>
              <span
                >Cr√©√© leÔºö<time datetime="1668781177724"
                  >2022-11-18 15:19</time
                ></span
              >
              <span
                >Mis √† jourÔºö<time datetime="1670486351719"
                  >2022-12-08 08:59</time
                ></span
              >
            </div>
            
            <div>
              Tags: 
              <span class="keyword">SLAM1</span>
              
            </div>
            
          </div>
        </header>
        <div class="article-content markdown-body"><h1 id="sql-aller-plus-loin">SQL - Aller plus loin</h1>
<p><a title="https://notebooks.lecluse.fr" href="https://notebooks.lecluse.fr">Source</a></p>
<nav class="table-of-contents"><ul><li><a href="#sql-aller-plus-loin">SQL - Aller plus loin</a></li><li><a href="#aller-plus-loin-en-sql">Aller plus loin en SQL</a><ul><li><a href="#aller-plus-loin-avec-select">Aller plus loin avec SELECT</a><ul><li><a href="#s√©lection-simple">S√©lection simple</a></li><li><a href="#s√©lection-avec-like">S√©lection avec LIKE</a></li><li><a href="#s√©lection-multiple">S√©lection multiple</a></li><li><a href="#compter-le-nombre-de-r√©ponses-dune-requ√™te-select">Compter le nombre de r√©ponses d'une requ√™te SELECT</a></li><li><a href="#trier-les-r√©ponses">Trier les r√©ponses</a></li><li><a href="#√©viter-les-occurrences-multiples">√âviter les occurrences multiples</a></li><li><a href="#wrench-travail-√†-r√©aliser">üîß Travail √† r√©aliser</a></li></ul></li><li><a href="#requ√™tes-portant-sur-plusieurs-tables">Requ√™tes portant sur plusieurs tables</a><ul><li><a href="#jointure">Jointure</a></li><li><a href="#wrench-travail-√†-r√©aliser-1">üîß Travail √† r√©aliser</a></li><li><a href="#le-cas-des-relations-de-n-√†-n">Le cas des relations de n √† n</a></li><li><a href="#wrench-travail-√†-r√©aliser-2">üîß Travail √† r√©aliser</a></li></ul></li></ul></li></ul></nav><hr />
<div style="page-break-after:always" class="jop-noMdConv"></div>
<h1 id="aller-plus-loin-en-sql">Aller plus loin en SQL</h1>
<p>Dans ce classeur, nous poursuivrons l'√©tude de l'exemple de la base de donn√©es de livres de SF et nous verrons des <strong>requ√™tes de s√©lection avanc√©es</strong> ainsi que la mani√®re de <strong>fusionner</strong> plusieurs tables (<strong>Jointures</strong>).</p>
<p>Rendez vous sur l'interface de gestion de votre base de donn√©es.</p>
<ul>
<li>PHPMyAdmin</li>
<li>SQLServer Mangament Console</li>
</ul>
<hr />
<div style="page-break-after:always" class="jop-noMdConv"></div>
<h2 id="aller-plus-loin-avec-select">Aller plus loin avec SELECT</h2>
<h3 id="s√©lection-simple">S√©lection simple</h3>
<p>Supposons que l'on veuille lister <strong>seulement</strong> les noms et pr√©noms des auteurs <strong>n√©s avant 1900</strong>, on utilisera une clause <strong>WHERE</strong> <em>condition</em> :</p>
<div><pre class="hljs"><code><span class="hljs-keyword">SELECT</span> NomAuteur, PrenomAuteur 
<span class="hljs-keyword">FROM</span> Auteurs 
<span class="hljs-keyword">WHERE</span> AnneeNaissance <span class="hljs-operator">&lt;</span> <span class="hljs-number">1900</span>;</code></pre></div>
<p>Pour obtebir les auteurs pr√©nomm√©s <em>Jules</em> :</p>
<div><pre class="hljs"><code><span class="hljs-keyword">SELECT</span> NomAuteur, PrenomAuteur <span class="hljs-keyword">from</span> Auteurs <span class="hljs-keyword">WHERE</span> PrenomAuteur <span class="hljs-operator">=</span> <span class="hljs-string">'Jules'</span>;</code></pre></div>
<p>Vous voyez que les textes sont d√©limit√©s par des quotes <strong>'...'</strong>.</p>
<p><em><strong>Attention</strong></em> : essayez de remplacer <strong>Jules</strong> par <strong>jules</strong> et vous constaterez que <strong>la recherche est sensible aux majuscules.</strong></p>
<hr />
<div style="page-break-after:always" class="jop-noMdConv"></div>
<h3 id="s√©lection-avec-like">S√©lection avec LIKE</h3>
<p>Supposons maintenant que l'on recherche les auteurs dont le pr√©nom commence par <strong>P</strong> :</p>
<p>Nous utiliserons une clause <em>LIKE</em> de cette mani√®re :</p>
<div><pre class="hljs"><code><span class="hljs-keyword">SELECT</span> NomAuteur, PrenomAuteur 
<span class="hljs-keyword">FROM</span> Auteurs 
<span class="hljs-keyword">WHERE</span> PrenomAuteur <span class="hljs-keyword">LIKE</span> <span class="hljs-string">'P%'</span>;</code></pre></div>
<p>Le caract√®re <strong>%</strong> est le caract√®re <strong>joker</strong> (wildcard) en sql.</p>
<hr />
<div style="page-break-after:always" class="jop-noMdConv"></div>
<h3 id="s√©lection-multiple">S√©lection multiple</h3>
<p>Il est possible de croiser plusieurs crit√®res √† l'aide d'op√©rateurs booleens : <strong>AND</strong> et <strong>OR</strong>. Voici la liste des auteurs fran√ßais n√©s apr√®s 1900 :</p>
<div><pre class="hljs"><code><span class="hljs-keyword">SELECT</span> NomAuteur, PrenomAuteur 
<span class="hljs-keyword">FROM</span> Auteurs 
<span class="hljs-keyword">WHERE</span> IdLangue <span class="hljs-operator">=</span> <span class="hljs-number">2</span> 
<span class="hljs-keyword">AND</span> AnneeNaissance <span class="hljs-operator">&gt;</span> <span class="hljs-number">1900</span>;</code></pre></div>
<p><img src="/_resources/4bdf27ff5777410cb09e1d1507bb171c.png" /></p>
<hr />
<div style="page-break-after:always" class="jop-noMdConv"></div>
<h3 id="compter-le-nombre-de-r√©ponses-dune-requ√™te-select">Compter le nombre de r√©ponses d'une requ√™te SELECT</h3>
<p>Combien y a t-il d'auteurs n√©s entre 1900 et 1915 ?<br />
Vous verrez √† l'occation l'utilisation de l'op√©rateur <em>BETWEEN</em> pour tester l'appartenance √† un intervalle.</p>
<div><pre class="hljs"><code><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>)
<span class="hljs-keyword">FROM</span> Auteurs
<span class="hljs-keyword">WHERE</span> AnneeNaissance <span class="hljs-keyword">BETWEEN</span> <span class="hljs-number">1900</span> <span class="hljs-keyword">AND</span> <span class="hljs-number">1915</span>;</code></pre></div>
<p><img src="/_resources/3fb6c8d107a64f329928e99b310e477b.png" /></p>
<hr />
<div style="page-break-after:always" class="jop-noMdConv"></div>
<h3 id="trier-les-r√©ponses">Trier les r√©ponses</h3>
<p>Nous allons lister <strong>tous les auteurs par ordre croissant d'ann√©e de naissance</strong></p>
<div><pre class="hljs"><code><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span>
<span class="hljs-keyword">FROM</span> Auteurs
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> AnneeNaissance;</code></pre></div>
<p><img src="/_resources/6a65bcac8b0341c99bc53278546342de.png" /></p>
<p>et par ordre d√©croissant, on ajoute <strong>DESC</strong> √† la fin de la requ√™te</p>
<div><pre class="hljs"><code><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span>
<span class="hljs-keyword">FROM</span> Auteurs
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> AnneeNaissance <span class="hljs-keyword">DESC</span>;</code></pre></div>
<p><img src="/_resources/b345fdd5985b4c6a88f3813e42a7d2b5.png" /></p>
<hr />
<div style="page-break-after:always" class="jop-noMdConv"></div>
<h3 id="√©viter-les-occurrences-multiples">√âviter les occurrences multiples</h3>
<p>Interrogeons la table <strong>Livres</strong> sur les <strong>ann√©es de publication</strong>, rang√©es par ordre <strong>croissant</strong> :</p>
<div><pre class="hljs"><code><span class="hljs-keyword">SELECT</span> AnneePubli
<span class="hljs-keyword">FROM</span> Livres
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> AnneePubli;</code></pre></div>
<p>On peut constater la pr√©sence de quelques doublons.</p>
<p>Pour <strong>√©viter les redondances</strong> dans les r√©sultats, on peut rajouter le mot-cl√© <em>DISTINCT</em> juste apr√®s le <em>SELECT</em> :</p>
<div><pre class="hljs"><code><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span> AnneePubli
<span class="hljs-keyword">FROM</span> Livres 
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> AnneePubli;</code></pre></div>
<hr />
<div style="page-break-after:always" class="jop-noMdConv"></div>
<blockquote>
<h3 id="wrench-travail-√†-r√©aliser">üîß <strong>Travail √† r√©aliser</strong></h3>
<ol>
<li>Donner la liste de tous les titres des livres √©crits entre 1920 et 1950.</li>
<li>Combien y en a t-il ?</li>
</ol>
</blockquote>
<hr />
<h2 id="requ√™tes-portant-sur-plusieurs-tables">Requ√™tes portant sur plusieurs tables</h2>
<p>Jusqu'√† pr√©sent, nos requ√™tes ne portaient que sur <strong>une seule table</strong>.</p>
<p>N√©anmoins notre liste de livres comporte des don√©es en provenance de plusieurs tables simultan√©ment.<br />
Nous allons voir comment effectuer des requ√™tes pour <strong>croiser des donn√©es</strong> en provenance de plusieurs tables.</p>
<div><pre class="hljs"><code><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> 
<span class="hljs-keyword">FROM</span> Langues, Auteurs;</code></pre></div>
<p>Comme on peut le constater cette requ√™te est peu pertinente car elle affiche <strong>toutes les donn√©es de chacune des tables sans effectuer de correspondances</strong>.</p>
<p>La <strong>cl√© de jointure</strong> appara√Æt pourtant ici clairement :</p>
<ul>
<li>il s'agit de <strong>id_langue</strong> qui doit permettre de recouper les informations entre les deux tables : il est en effet inutile d'afficher les donn√©es pour lesquelles les langues ne correspondent pas entre les deux tables.</li>
</ul>
<hr />
<div style="page-break-after:always" class="jop-noMdConv"></div>
<h3 id="jointure">Jointure</h3>
<p>La <strong>jointure</strong> consiste √† croiser les donn√©es de plusieurs tables pour les pr√©senter sous forme d'un seul tableau.</p>
<p>On va utiliser ce m√©canisme pour afficher clairement la langue de l'auteur plut√¥t qu'un num√©ro qui n'est pas forc√©ment tr√®s parlant.<br />
Nous utiliserons pour cela l'op√©rateur <strong>JOIN ... ON</strong> :</p>
<div><pre class="hljs"><code><span class="hljs-keyword">SELECT</span> NomAuteur, PrenomAuteur, Langue, AnneeNaissance
<span class="hljs-keyword">FROM</span> Auteurs 
<span class="hljs-keyword">JOIN</span> Langues 
<span class="hljs-keyword">ON</span> Auteurs.IdLangue <span class="hljs-operator">=</span> Langues.IdLangue;</code></pre></div>
<p>Les champs sur lesquels faire la jointure <strong>ayant les m√™mes noms dans les 2 tables</strong>, cette requ√™te peut aussi √™tre √©crite plus simplement en utilisant le mot-cl√© <strong>USING</strong> ainsi :</p>
<div><pre class="hljs"><code><span class="hljs-keyword">SELECT</span> NomAuteur, PrenomAuteur, Langue, AnneeNaissance
<span class="hljs-keyword">FROM</span> Auteurs 
<span class="hljs-keyword">JOIN</span> Langues 
<span class="hljs-keyword">USING</span> (IdLangue);</code></pre></div>
<hr />
<div style="page-break-after:always" class="jop-noMdConv"></div>
<blockquote>
<h3 id="wrench-travail-√†-r√©aliser-2">üîß <strong>Travail √† r√©aliser</strong></h3>
<p>En croisant la table <strong>Livres</strong> avec la table <strong>Auteurs</strong></p>
<ol>
<li>Afficher une liste pr√©sentant les champs <strong>Titre</strong>, <strong>PrenomAuteur</strong>, <strong>NomAuteur</strong> et <strong>AnneePubli</strong>, tri√©e du <strong>plus r√©cent au plus ancien</strong>.</li>
</ol>
</blockquote>

<blockquote>
<ol start="2">
<li>Afficher une liste pr√©sentant les champs  <strong>Titre</strong>, <strong>PrenomAuteur</strong>, <strong>NomAuteur</strong> et <strong>AnneePubli</strong> √©crits en fran√ßais.</li>
</ol>
</blockquote>

<hr />
<div style="page-break-after:always" class="jop-noMdConv"></div>
<h3 id="le-cas-des-relations-de-n-√†-n">Le cas des relations de n √† n</h3>
<p>Parfois il arrive que les donn√©es √† collecter se trouvent <strong>dans plus que deux tables</strong> :<br />
c'est le cas des <strong>Th√®mes pour les livres</strong></p>
<p>Ce cas n√©cessite l'analyse de 3 tables : <strong>Livres</strong> et <strong>Th√®mes</strong> bien s√ªr, mais aussi la table de relation <strong>RelationsLivreTheme</strong>.</p>
<p><img src="/_resources/add75b84bc8540b889a1f3111422c855.png" /><br />
Observez et √©tudiez la requ√™te suivante :</p>
<ul>
<li>
<p>Le principe est d'encha√Æner deux jointures <strong>JOIN ... USING</strong> ou <strong>JOIN ... ON</strong> en utilisant <em><strong>la table de Relation au milieu</strong></em>.</p>
</li>
<li>
<p>En effet, la requ√™te se lit de la gauche vers la droite et <strong>on ne peut faire de jointure que si on a une cl√© externe en commun</strong>, ce qui n'est par exemple pas le cas entre <strong>Livres</strong> et <strong>Th√®mes</strong>.</p>
</li>
</ul>
<div><pre class="hljs"><code><span class="hljs-keyword">SELECT</span> Titre, Intitule
<span class="hljs-keyword">FROM</span> Livres 
<span class="hljs-keyword">JOIN</span> RelationsLivreTheme 
<span class="hljs-keyword">USING</span> (IdLivre) 
<span class="hljs-keyword">JOIN</span> Themes <span class="hljs-keyword">USING</span> (IdTheme);</code></pre></div>
<p>ou avec <strong>JOIN ... ON</strong>:</p>
<div><pre class="hljs"><code><span class="hljs-keyword">SELECT</span> Titre, Intitule
<span class="hljs-keyword">FROM</span> Livres 
<span class="hljs-keyword">JOIN</span> RelationsLivreTheme 
<span class="hljs-keyword">ON</span> Livres.IdLivre <span class="hljs-operator">=</span> RelationsLivretheme.IdLivre

<span class="hljs-keyword">JOIN</span> Themes
<span class="hljs-keyword">ON</span> RelationsLivreTheme.IdTheme <span class="hljs-operator">=</span> Themes.IdTheme;</code></pre></div>
<p><img src="/_resources/83dcb82fd3554048b985c5eb377bd3bf.png" /></p>
<hr />
<div style="page-break-after:always" class="jop-noMdConv"></div>
<blockquote>
<h3 id="wrench-travail-√†-r√©aliser-3">üîß <strong>Travail √† r√©aliser</strong></h3>
<p>Ecrire une requ√™te permettant d'obtenir une liste dont les attributs sont <strong>Titre</strong>, <strong>NomAuteur</strong> et <strong>Langue</strong> tri√©e par ordre croissant de date de naissance de l'auteur.</p>
</blockquote>

</div>
      </article>
    </div>

    <div class="go-top">
    <p class="go-top-text">Retour Haut de page</p>
</div>

    <!-- JQuery -->
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js" type="text/javascript"></script>

<!-- Local -->
<script src="/_assets/js/script.js" type="text/javascript"></script>
  </body>
</html>